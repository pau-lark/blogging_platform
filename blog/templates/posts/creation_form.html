{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}{% endblock %}

{% block content %}
    <div class="row w-75 mx-auto my-3">
        <div class="col-lg-8">
        <h2>Создание поста</h2>
            <form method="post" action="." enctype="multipart/form-data">
                {% csrf_token %}
                {{ post_form.category|as_crispy_field }}
                {{ post_form.title|as_crispy_field }}
                <figure class="my-4">
                    <img id="img_preview" class="img-fluid rounded" src="" alt="..."/>
                </figure>
                {{ post_form.poster|as_crispy_field }}
                <hr>
                <h3>Добавить контент</h3>
                <div id="post-content"></div>
                <a href="#" class="add-post-content btn btn-dark" data-content="text">Текст</a>
                <a href="#" class="add-post-content btn btn-dark" data-content="image">Картинку</a>
                <hr>
                <input type="submit" value="Опубликовать" class="btn btn-dark">
            </form>
        </div>
        <div class="col-lg-4">
        </div>
    </div>
    <script>
        let loadImage = function(event){
            let preview = document.getElementById('img_preview');
            preview.src = URL.createObjectURL(event.target.files[0]);
            preview.onload = function(){
                URL.revokeObjectURL(preview.src)
            }
        };
    </script>
{% endblock %}

{% block domready %}
<script>
    $(document).ready(function(){
        $('a.add-post-content').click(function(e){
            e.preventDefault();
            $.get('/blog/posts/create/add_content/?content=' + $(this).data('content'),
            function(data){
                console.log(data);
                $('#post-content').append(data);

            });
        });
    });
</script>
{% endblock %}